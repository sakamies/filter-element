<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Search filter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="module">
      import { filterer } from '/search.js'
      document.addEventListener("DOMContentLoaded", () => {

        //Search index should be rendered into the html already, but this is to illustrate building a search index so I don't have to hand code it into this example.
        Array.from(document.querySelectorAll('tbody :is(th,td)')).forEach(el => {
          el.setAttribute('data-search', el.textContent)
        })
        Array.from(document.querySelectorAll('tbody td:last-child')).forEach(el => {
          el.setAttribute('data-state', el.textContent)
        })

        let textHits = Infinity
        let radioHits = Infinity
        const renderHits = () => hits.innerHTML = Math.min(textHits, radioHits)

        filterer({
          name: 'search',
          row: '#gifts tbody tr',
          callback (matches) {textHits = matches.length; renderHits()},
        })

        filterer({
          name: 'state',
          row: '#gifts tbody tr',
          callback (matches) {radioHits = matches.length; renderHits()},
        })

      });
    </script>
  </head>
  <body>
    <h1>Filter</h1>
    <p>Matching rows will be shown. Matching cells will be highlighted.</p>

    <p id="text-filter">
      <label for="search">Filter by text</label>
      <input id="search" name="search" type="search">
    </p>
    <fieldset id="radio-filter">
      <legend>Filter by type</legend>
      <input type="radio" id="state-any" name="state" checked value>
      <label for="state-any">Any</label>
      <input type="radio" id="state-sent" name="state" value="sent">
      <label for="state-sent">Sent</label>
      <input type="radio" id="state-paid" name="state" value="recieved">
      <label for="state-paid">Recieved</label>
      <input type="radio" id="state-late" name="state" value="late">
      <label for="state-late">Late</label>
    </fieldset>
    <p aria-live="polite">
      <span id="hits">5</span> rows
    </p>

    <table id="gifts">
      <caption>Gifts</caption>
      <thead>
        <tr>
          <th>Recipient</th>
          <th>Gift</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>&gt;&lt;img src="hack"&gt;</td>
          <td>Teddybear</td>
          <td>Sent</td>
        </tr>
        <tr>
          <td>Orlando Cantu</td>
          <td>Plush kitten</td>
          <td>Sent</td>
        </tr>
        <tr>
          <td>Brian Hale</td>
          <td>Flowers</td>
          <td>Recieved</td>
        </tr>
        <tr>
          <td>Foster Snyder</td>
          <td>Chocolate</td>
          <td>Late</td>
        </tr>
        <tr>
          <td>Isaias Ruiz</td>
          <td>ðŸ‘»ðŸ¤–ðŸŽˆ</td>
          <td>Recieved</td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
