<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Search filter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="module">
      import { FilterAble } from '/filter.js'
      customElements.define('filter-able', FilterAble);

      document.addEventListener("DOMContentLoaded", () => {

        // Search index should be rendered into the html already, but this is to illustrate building a search index so I don't have to hand code it into this example.
        // Search by text from any column
        Array.from(document.querySelectorAll('tbody tr > :is(th,td)')).forEach(el => {
          el.setAttribute('data-filter-able-search', el.textContent)
        })
        // Gift type and checkboxes for filters
        Array.from(document.querySelectorAll('tbody tr > :nth-child(2)')).forEach(el => {
          el.setAttribute('data-filter-able-gift', el.textContent)
        })
        // Last column is state
        Array.from(document.querySelectorAll('tbody tr > :last-child')).forEach(el => {
          el.setAttribute('data-filter-able-state', el.textContent)
        })

        // Update found count and announce it with aria-live.
        // Events and data-attributes are named whatever you choose as your tag name for this custom element.
        const count = document.querySelector('#count')
        document.addEventListener('filter-able:search', event => {
          count.textContent = event.detail.found.size
        })
      });
    </script>
  </head>
  <body>
    <h1>Filter</h1>
    <p>Matching rows will be shown. Matching cells will be highlighted.</p>

    <form name="filters">
      <p>
        <label for="search">Filter by text</label>
        <input id="search" name="search" type="search">
      </p>
      <fieldset>
        <legend>Status</legend>
        <input type="radio" id="state-any" name="state" checked value>
        <label for="state-any">Any</label>
        <input type="radio" id="state-sent" name="state" value="sent">
        <label for="state-sent">Sent</label>
        <input type="radio" id="state-paid" name="state" value="recieved">
        <label for="state-paid">Recieved</label>
        <input type="radio" id="state-late" name="state" value="late">
        <label for="state-late">Late</label>
      </fieldset>
      <br>
      <fieldset>
        <legend>Gift</legend>
        <input type="checkbox" id="gift-is-plush" name="gift" value="plush">
        <label for="gift-is-plush">Plush</label>
        <input type="checkbox" id="gift-is-fragrant" name="gift" value="fragrant">
        <label for="gift-is-fragrant">Fragrant</label>
        <input type="checkbox" id="gift-is-spooky" name="gift" value="spooky">
        <label for="gift-is-spooky">Spooky</label>
      </fieldset>
      <p aria-live="polite">
        <span id="count">5</span> rows
      </p>
    </form>

    <!-- <filter-able form="filters" rows="tbody tr" style="--filter-able-hilite: LemonChiffon;"> -->
    <filter-able>
      <table>
        <caption>Gifts</caption>
        <thead>
          <tr>
            <th>Recipient</th>
            <th>Gift</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Orlando Cantu</td>
            <td>Plush Kitten</td>
            <td>Sent</td>
          </tr>
          <tr>
            <td>Brian Hale</td>
            <td>Fragrant Flowers</td>
            <td>Recieved</td>
          </tr>
          <tr>
            <td>Foster Snyder</td>
            <td>Fragrant Chocolate</td>
            <td>Late</td>
          </tr>
          <tr>
            <td>Isaias Ruiz</td>
            <td>Spooky Fragrant Ice</td>
            <td>Recieved</td>
          </tr>
          <tr>
            <td>&gt;&lt;img src="hack"&gt;</td>
            <td>Can't Hack This</td>
            <td>ðŸ’Œ Sent</td>
          </tr>
        </tbody>
      </table>
    </filter-able>

    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
  </body>
</html>
