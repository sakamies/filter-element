<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Search filter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="module">
      import { filterer } from '/filter.js'
      document.addEventListener("DOMContentLoaded", () => {

        // Search index should be rendered into the html already, but this is to illustrate building a search index so I don't have to hand code it into this example.

        // You can search by text from any column
        Array.from(document.querySelectorAll('tbody tr > :is(th,td)')).forEach(el => {
          el.setAttribute('data-search', el.textContent)
        })
        // Last column is state
        Array.from(document.querySelectorAll('tbody tr > :last-child')).forEach(el => {
          el.setAttribute('data-state', el.textContent)
        })
        // This column is for gift type and has checkboxes for filters
        Array.from(document.querySelectorAll('tbody tr > :nth-child(2)')).forEach(el => {
          el.setAttribute('data-gift', el.textContent)
        })

        // For simple pages with just one form for the search and a table or something. Listens to all inputs and filters selected elements based on those.
        // filterer({selector: 'tbody tr'})

        // If you have more than one form, one of which is your filterer form, you can select the form via its name or id.
        // filterer({form: 'filter', selector: 'tbody tr'})

        // If you want to do something with the found matches after a search, you can use a callback. This would log selected rows and the search terms that matched.
        // filterer({selector: 'tbody tr', callback: console.log})

        filterer({
          form: 'filter',
          table: '#gifts',
          row: 'tbody tr',
          callback (matches) {count.innerHTML = matches.length},
        })

      });
    </script>
  </head>
  <body>
    <h1>Filter</h1>
    <p>Matching rows will be shown. Matching cells will be highlighted.</p>

    <form name="filters">
      <p>
        <label for="search">Filter by text</label>
        <input id="search" name="search" type="search">
      </p>
      <fieldset>
        <legend>Status</legend>
        <input type="radio" id="state-any" name="state" checked value>
        <label for="state-any">Any</label>
        <input type="radio" id="state-sent" name="state" value="sent">
        <label for="state-sent">Sent</label>
        <input type="radio" id="state-paid" name="state" value="recieved">
        <label for="state-paid">Recieved</label>
        <input type="radio" id="state-late" name="state" value="late">
        <label for="state-late">Late</label>
      </fieldset>
      <br>
      <fieldset>
        <legend>Gift</legend>
        <input type="checkbox" id="gift-is-teddy" name="gift" value="T">
        <label for="gift-is-teddy">T</label>
        <input type="checkbox" id="gift-is-chocolate" name="gift" value="K">
        <label for="gift-is-chocolate">K</label>
      </fieldset>
      <p aria-live="polite">
        <span id="count">5</span> rows
      </p>
    </form>

    <!-- <filter-able form="filters" row="tbody td"> -->
      <table id="gifts">
        <caption>Gifts</caption>
        <thead>
          <tr>
            <th>Recipient</th>
            <th>Gift</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>&gt;&lt;img src="hack"&gt;</td>
            <td>Plush Teddybear</td>
            <td>Sent</td>
          </tr>
          <tr>
            <td>Orlando Cantu</td>
            <td>Plush Kitten</td>
            <td>Sent</td>
          </tr>
          <tr>
            <td>Brian Hale</td>
            <td>Fragrant Flowers</td>
            <td>Recieved</td>
          </tr>
          <tr>
            <td>Foster Snyder</td>
            <td>Fragrant Chocolate</td>
            <td>Late</td>
          </tr>
          <tr>
            <td>Isaias Ruiz</td>
            <td>Spooky ðŸ‘»ðŸ¤–ðŸŽˆ</td>
            <td>Recieved</td>
          </tr>
        </tbody>
      </table>
    <!-- </filter-able> -->

    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
  </body>
</html>
