<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Search filter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="module">
      import { Filter } from '/filter.js'
      const tagName = 'filter-'
      customElements.define(tagName, Filter);

      document.addEventListener("DOMContentLoaded", () => {

        // Search index should be rendered into the html already, but this is to illustrate building a search index so I don't have to hand code it into this example.
        // Search by text from any column
        Array.from(document.querySelectorAll('tbody tr > :is(th,td)')).forEach(el => {
          el.setAttribute(tagName+'-search', el.textContent)
        })
        // Gift type and checkboxes for filters
        Array.from(document.querySelectorAll('tbody tr > :nth-child(2)')).forEach(el => {
          el.setAttribute(tagName+'-gift', el.textContent)
        })
        // Last column is state
        Array.from(document.querySelectorAll('tbody tr > :last-child')).forEach(el => {
          el.setAttribute(tagName+'-state', el.textContent)
        })

        // Update found count and announce it with aria-live.
        // Events and attributes are named whatever you choose as your tagName for this custom element.
        const count = document.querySelector('#count')
        document.addEventListener(tagName, event => {
          count.textContent = event.detail.found.length
          // The event is cancelable. Using preventDefault will prevent hiding the affected elements.
          // So you can grab the results of the filtering and do whatever if you need to.
          //event.preventDefault
        })
      });

      //Just to make sure there's no crash
      document.createElement(tagName)
    </script>
  </head>
  <body>
    <h1>Filter</h1>

    <form name="filters">
      <div class="field">
        <label for="search-includes">Search</label>
        <input id="search-includes" name="search" type="search">
        <!-- 'tagName-search' attribute must include this text as a substring. -->
      </div>
      <div class="field">
        <label for="search">Fuzzy words search</label>
        <input id="search" name="search:fuzzy" type="search">
        <!-- 'tagName-search' attribute must include these words in any order. -->
      </div>
      <div class="field">
        <label for="search">Negative fuzzy search</label>
        <input id="search" name="search:fuzzy:not" type="search">
      </div>
      <div class="field">
        <label for="search-exact">Exact text search</label>
        <input id="search-exact" name="search:exact" type="search">
        <!-- 'tagName-search' attribute must be this exact value. -->
      </div>
      <br>
      <!-- Radios and checkboxes, selects and textareas work the same as text inputs. -->
      <fieldset>
        <legend>Status</legend>
        <input type="radio" id="state-any" name="state" checked value>
        <label for="state-any">Any</label>
        <input type="radio" id="state-sent" name="state" value="sent">
        <label for="state-sent">Sent</label>
        <input type="radio" id="state-paid" name="state" value="recieved">
        <label for="state-paid">Recieved</label>
        <input type="radio" id="state-late" name="state" value="late">
        <label for="state-late">Late</label>
      </fieldset>
      <br>
      <!-- Radios and checkboxes work the same as text inputs. Here 'tagName-state' must include the value of the checked radio. -->
      <fieldset>
        <legend>Gift</legend>
        <input type="checkbox" id="gift-is-plush" name="gift" value="plush">
        <label for="gift-is-plush">Plush</label>
        <input type="checkbox" id="gift-is-fragrant" name="gift" value="fragrant">
        <label for="gift-is-fragrant">Fragrant</label>
        <input type="checkbox" id="gift-is-spooky" name="gift" value="spooky">
        <label for="gift-is-spooky">Spooky</label>
        <input type="checkbox" id="gift-is-spooky-and-fragrant" name="gift" value="spooky fragrant">
        <label for="gift-is-spooky-and-fragrant">Spooky & Fragrant</label>
      </fieldset>
      <p>
        <!-- Use :not suffix on input name to have this value be excluded from the results instead of being included. -->
        <input type="checkbox" id="gift-not-spooky" name="gift:not" value="spooky">
        <label for="gift-not-spooky">Non spooky things</label>
      </p>
    </form>

    <!-- [form=""] Optional form name or id. If blank, closest parent form or the first form in the document is used. -->
    <!-- [target=""] Optional target element id. Will filter target element children. Optional, defaults to the filter element itself. -->
    <!-- [index=""] Optional input element name to automatically build an index for that name. Handy for simple cases.-->
    <filter- form="filters" target="gift-rows">
      <table>
        <caption aria-live="polite">
          <span id="count">5</span>
          Gifts
        </caption>
        <thead>
          <tr>
            <th>Recipient</th>
            <th>Gift</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="gift-rows">
          <tr>
            <td>Orlando Cantu</td>
            <td>Plush Kitten</td>
            <td>Sent</td>
          </tr>
          <tr>
            <td>Brian Hale</td>
            <td>Fragrant Flowers</td>
            <td>Recieved</td>
          </tr>
          <tr>
            <td>Foster Snyder</td>
            <td>Fragrant Chocolate</td>
            <td>Recieved</td>
          </tr>
          <tr>
            <td>Isaias Ruiz</td>
            <td>Spooky Fragrant Ice Cream</td>
            <td>Late</td>
          </tr>
          <tr>
            <td>&gt;&lt;img src="hack"&gt;</td>
            <td>Can't Hack This</td>
            <td>ðŸ’ŒSentðŸ’Œ</td>
          </tr>
        </tbody>
      </table>
    </filter->
  </body>
</html>
